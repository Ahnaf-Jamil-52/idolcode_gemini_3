{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Behavioral Events Schema",
  "description": "Schema for behavioral events tracked by the coach engine",
  "type": "object",
  "definitions": {
    "event": {
      "type": "object",
      "required": ["event_type", "timestamp", "user_id"],
      "properties": {
        "event_type": {
          "type": "string",
          "enum": [
            "submission",
            "wrong_answer",
            "problem_opened",
            "problem_skipped",
            "problem_solved",
            "ghost_race_result",
            "hint_requested",
            "hint_declined",
            "code_paste",
            "tab_switch",
            "idle_detected",
            "session_start",
            "session_end"
          ],
          "description": "Type of behavioral event"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of event"
        },
        "user_id": {
          "type": "string",
          "description": "User identifier"
        },
        "session_id": {
          "type": "string",
          "description": "Session identifier"
        },
        "metadata": {
          "type": "object",
          "description": "Event-specific metadata",
          "properties": {
            "problem_id": { "type": "string" },
            "won": { "type": "boolean" },
            "time_taken_seconds": { "type": "number" },
            "idle_minutes": { "type": "number" },
            "verdict": { "type": "string" }
          }
        }
      }
    },
    "signal": {
      "type": "object",
      "required": ["signal_type", "timestamp", "weight"],
      "properties": {
        "signal_type": {
          "type": "string",
          "enum": [
            "rapid_wa_burst",
            "submission_then_silence",
            "problem_skip_streak",
            "session_length_decay",
            "ghost_loss_streak",
            "time_between_sessions_growth",
            "hint_dependency",
            "idle_on_problem",
            "copy_paste_detection",
            "tab_away_frequency",
            "successful_solve",
            "ghost_win",
            "hint_declined",
            "long_focused_session"
          ],
          "description": "Type of detected behavioral signal"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "weight": {
          "type": "number",
          "minimum": -1.0,
          "maximum": 1.0,
          "description": "Signal weight for burnout calculation"
        },
        "metadata": {
          "type": "object",
          "description": "Signal-specific metadata"
        }
      }
    }
  },
  "properties": {
    "events": {
      "type": "array",
      "items": { "$ref": "#/definitions/event" }
    },
    "detected_signals": {
      "type": "array",
      "items": { "$ref": "#/definitions/signal" }
    }
  }
}
